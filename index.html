<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Muse","version":"7.7.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="沫的博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="沫的博客">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="沫">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: true,
    isPost: false
  };
</script>

  <title>沫的博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">沫的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/10/26/blibli/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="沫">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沫的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/10/26/blibli/" class="post-title-link" itemprop="url">blibli-1024</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-10-26 16:00:00 / 修改时间：18:15:13" itemprop="dateCreated datePublished" datetime="2020-10-26T16:00:00+08:00">2020-10-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index">
                    <span itemprop="name">渗透测试</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="哔哩哔哩1024之33的挑战状"><a href="#哔哩哔哩1024之33的挑战状" class="headerlink" title="哔哩哔哩1024之33的挑战状"></a>哔哩哔哩1024之33的挑战状</h3><p>b站在1024程序员的节日里发布了10道题，我们需要获取flag进行通关并获取积分，并有丰富的奖励。<br><img src="/images/pasted-216.png" alt="upload successful"></p>
<h4 id="1-页面的背后是什么？"><a href="#1-页面的背后是什么？" class="headerlink" title="1.页面的背后是什么？"></a>1.页面的背后是什么？</h4><p>url地址:<a href="http://45.113.201.36/index.html" target="_blank" rel="noopener">http://45.113.201.36/index.html</a></p>
<p>通过页面代码查看，第一题发送了一个ajax请求，如果状态码是200那么就会获取flag，来自/admin/这个包<br><img src="/images/pasted-217.png" alt="upload successful"><br>所以我们可以通过页面搜索flag1得出一个隐藏的输入框获取flag，或者查看<a href="http://45.113.201.36/admin这个包" target="_blank" rel="noopener">http://45.113.201.36/admin这个包</a></p>
<p>通过页面搜索flag获取flag</p>
<p><img src="/images/pasted-218.png" alt="upload successful"></p>
<p>通过查看包请求获取flag，在这里插入一个HSQ&amp;dl开发的一款开源工具包崖剑，使用该工具获取flag<br><img src="/images/pasted-219.png" alt="upload successful"></p>
<p>获取的flag</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"code"</span>:<span class="number">200</span>,<span class="attr">"data"</span>:<span class="string">"231a6c6b-fa35686c-248bb8e5-ebb96aaa"</span>,<span class="attr">"msg"</span>:<span class="string">""</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-真正的秘密只有特殊的设备才能看到"><a href="#2-真正的秘密只有特殊的设备才能看到" class="headerlink" title="2.真正的秘密只有特殊的设备才能看到"></a>2.真正的秘密只有特殊的设备才能看到</h4><p>url地址:<a href="http://45.113.201.36/index.html" target="_blank" rel="noopener">http://45.113.201.36/index.html</a></p>
<p>通过阅读第二个falg获取的ajax请求，发现他需要使用bilibili Security Browser浏览器访问，那么就很简单了，我们使用刚刚的崖剑去伪造一个同样的数据包，我们都知道校验浏览器设备是请求头里User-Agent这个参数，那么接下来简单交大家使用一下崖剑快速发送一个包</p>
<p>来自第二题的请求包</p>
<p><img src="/images/pasted-220.png" alt="upload successful"><br>我们这个时候必须要使用工具去伪造这个请求，我们只需要吧图下的两个参数复制到崖剑即可使用<br><img src="/images/pasted-221.png" alt="upload successful"><br>接下来配置一下崖剑这个工具</p>
<p><img src="/images/pasted-222.png" alt="upload successful"><br>崖剑配置好了我们只需要吧替换成b站需要的头信息</p>
<p><img src="/images/pasted-223.png" alt="upload successful"><br>然后替换好user-agent点击发送就可以获取第二题的flag了</p>
<p><img src="/images/pasted-224.png" alt="upload successful"></p>
<p>获取的flag</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"code"</span>:<span class="number">200</span>,<span class="attr">"data"</span>:<span class="string">"cb2effe3-e84d2a0d-b2ace7c2-6846159f"</span>,<span class="attr">"msg"</span>:<span class="string">""</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-密码是啥？"><a href="#3-密码是啥？" class="headerlink" title="3.密码是啥？"></a>3.密码是啥？</h4><p>url地址:<a href="http://45.113.201.36/login.html" target="_blank" rel="noopener">http://45.113.201.36/login.html</a></p>
<p>进入页面后发现有一个账号密码登陆框，那么这样的话，应该是弱口令没的洗了，下图是我抓取的一个登陆包，准备工具跑，然后自己手动测试了几个参数，账号admin密码bilibili，就获取到flag了</p>
<p><img src="/images/pasted-225.png" alt="upload successful"></p>
<p>正确就返回flag<br><img src="/images/pasted-226.png" alt="upload successful"></p>
<p>获取的flag</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"code"</span>:<span class="number">200</span>,<span class="attr">"data"</span>:<span class="string">"9c79ad4a-0604ec67-01ade67d-e4deffbc"</span>,<span class="attr">"msg"</span>:<span class="string">""</span>&#125;</span><br></pre></td></tr></table></figure>
<p>说实话b站这次出得题并不是很难，基本都是渗透测试最简单入门的娱乐题目</p>
<h4 id="4-对不起，权限不足～"><a href="#4-对不起，权限不足～" class="headerlink" title="4.对不起，权限不足～"></a>4.对不起，权限不足～</h4><p>url地址:<a href="http://45.113.201.36/superadmin.html" target="_blank" rel="noopener">http://45.113.201.36/superadmin.html</a></p>
<p>进入页面后发现，权限不足，初步判断是越权漏洞</p>
<p>通过抓包发现，他是一个get请求并没有传递任何参数，但是cookie里多了一个参数role就是角色的意思，参数后面像一个md5的32位加密，我们先拿md5去撞库试试</p>
<p><img src="/images/pasted-228.png" alt="upload successful"></p>
<p>撞库结果是user，那么就可以判断他可能是通过该加密值进行权限鉴定的<br><img src="/images/pasted-229.png" alt="upload successful"></p>
<p>我们都知道后台常用账号是admin Administrator root啊 等等，偷偷告诉大家一个秘密(实际是想打广告了。)python程序员开发后台账号更加偏向于root，php更加偏向于admin，所以我们字典里一定要有这2个账号</p>
<p>进行ping检测实现简单的指纹收集，通过ttl值判断他的服务器类型</p>
<p>简单介绍一下这个ping检测，他是一个拥有一个高速线程并快速进行分析的插件，2秒就可以实现130条线路的检测和响应结果，这里是办成品。。。并没有完全完成数据分析。<br><img src="/images/pasted-227.png" alt="upload successful"></p>
<p>打开崖剑继续伪造一个请求，把这里改成Administrator的md5加密结果就行</p>
<p><img src="/images/pasted-230.png" alt="upload successful"></p>
<p>获取的flag</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"code"</span>:<span class="number">200</span>,<span class="attr">"data"</span>:<span class="string">"f0647fff-f5a3464a-29ded487-8808d760"</span>,<span class="attr">"msg"</span>:<span class="string">""</span>&#125;</span><br></pre></td></tr></table></figure>

<h4 id="别人的秘密"><a href="#别人的秘密" class="headerlink" title="别人的秘密"></a>别人的秘密</h4><p>url地址:<a href="http://45.113.201.36/api/ctf/5?uid=100336889" target="_blank" rel="noopener">http://45.113.201.36/api/ctf/5?uid=100336889</a></p>
<p>通过抓包发现通过第五题的flag是来这个包，应该也是越权漏洞，通过便利uid值获取其他人的数据<br><img src="/images/pasted-231.png" alt="upload successful"></p>
<p>这个需要使用用崖剑的一个工具，先填充请求包，先快速的生成源码，然后改写一下代码， 即可完成便利，因为弱口令模块还在开发目前无法使用。。。</p>
<p><img src="/images/pasted-232.png" alt="upload successful"></p>
<p>改写好后的源码开始进行爆破，如果爆破到结果就写到文件，上下范围100，大概4秒左右就跑完了。。。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_request</span><span class="params">(id)</span>:</span></span><br><span class="line">    url = <span class="string">"http://45.113.201.36/api/ctf/5?uid=&#123;&#125;"</span>.format(id)</span><br><span class="line">    headers = &#123;</span><br><span class="line">        <span class="string">'Accept'</span>: <span class="string">'*/*'</span>,</span><br><span class="line">        <span class="string">'Accept-Encoding'</span>: <span class="string">'gzip, deflate'</span>,</span><br><span class="line">        <span class="string">'Accept-Language'</span>: <span class="string">'zh-CN,zh;q=0.9'</span>,</span><br><span class="line">        <span class="string">'Cookie'</span>: <span class="string">'W=5f913de1-c5c; role=ee11cbb19052e40b07aac0ca060c23ee; session=eyJ1aWQiOiIxMjE4MjkwMTUifQ.X5UgFw.NBnkPIu38XQz-OqsbxkQc_FUdCY'</span>,</span><br><span class="line">        <span class="string">'Host'</span>: <span class="string">'45.113.201.36'</span>,</span><br><span class="line">        <span class="string">'Proxy-Connection'</span>: <span class="string">'keep-alive'</span>,</span><br><span class="line">        <span class="string">'Referer'</span>: <span class="string">'http://45.113.201.36/superadmin.html'</span>,</span><br><span class="line">        <span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/88.0.4292.2 Safari/537.36'</span>,</span><br><span class="line">        <span class="string">'X-Requested-With'</span>: <span class="string">'XMLHttpRequest'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        r_obj = requests.get(url=url, headers=headers)</span><br><span class="line">        result = eval(r_obj.content.decode())</span><br><span class="line">        print(result, url)</span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">'code'</span>] != <span class="string">'403'</span>:</span><br><span class="line">            <span class="keyword">with</span> open(<span class="string">'./flag.txt'</span>, <span class="string">'w'</span>, encoding=<span class="string">'utf-8'</span>)<span class="keyword">as</span> f:</span><br><span class="line">                f.write(str(url))</span><br><span class="line">                print(<span class="string">'写入成功'</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(e)</span><br><span class="line">    <span class="comment"># print(r_obj.content)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100336689</span>, <span class="number">100336989</span>):</span><br><span class="line">        t = threading.Thread(target=send_request, args=(i,))</span><br><span class="line">        t.start()</span><br><span class="line">        time.sleep(<span class="number">0.01</span>)</span><br></pre></td></tr></table></figure>

<p>通过爆破获取的flag</p>
<p><img src="/images/pasted-233.png" alt="upload successful"><br>flag的请求地址</p>
<p><img src="/images/pasted-234.png" alt="upload successful"></p>
<p>获取的flag</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;'code': 200, 'data': '9a0a74fe-43f218c7-42bc7274-615652be', 'msg': ''&#125;</span><br></pre></td></tr></table></figure>

<h4 id="结束亦是开始"><a href="#结束亦是开始" class="headerlink" title="结束亦是开始"></a>结束亦是开始</h4><p><a href="http://45.113.201.36/blog/single.php?id=1" target="_blank" rel="noopener">http://45.113.201.36/blog/single.php?id=1</a></p>
<p>这个题目我拿到手其实挺蒙蔽的。。还以为也是循环这个id=1越权漏洞，最后没做出来，使用nmap先做个简单的信息收集</p>
<p><img src="/images/pasted-235.png" alt="upload successful"><br>发现他开放了6379redis数据库，存在redsi未授权漏洞,收集做完后，发现是第8题的答案，还是没获取第六题flag</p>
<p><img src="/images/pasted-236.png" alt="upload successful"></p>
<p>第8题flag redis-未授权漏洞</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">d436b982-2b81aa54-49a8d2db-87ab951a</span><br></pre></td></tr></table></figure>
<p>扫一下目录看看有没有其他文件。。。写这个文章的时候用的是mac扫目录用的win所以就不写过程了，最后得出2个有用的文件一个是test.php访问得出一堆括号</p>
<p><img src="/images/pasted-237.png" alt="upload successful"><br>做过ctf题的人都知道，这个是js，虽然我没了解过原理但是我知道吧他方在控制台或者调试js都可以获取答案，这里是编码过的，我们去进行解码</p>
<p><img src="/images/pasted-238.png" alt="upload successful"><br>我们通过unicode解码获取到的结果是，程序员最多的地方，其实当时我想了很久才知道，是github。。。。虽然我经常用github，那我们就去github搜索bilibili1024havefun</p>
<p><img src="/images/pasted-239.png" alt="upload successful"><br>原来已经有这么多大佬做到这里了，太难了太难了</p>
<p><img src="/images/pasted-240.png" alt="upload successful"></p>
<p>然后得到一个php源码</p>
<p>简单理解就是id为不含1的数组，路径需要去猜测，然后他去读取文件，那我们就访问一下end.php去构建这么一个参数<br><img src="/images/pasted-241.png" alt="upload successful"><br>猜测路径是：<a href="http://45.113.201.36/blog/end.php?id[]=&amp;url=./flag.txt" target="_blank" rel="noopener">http://45.113.201.36/blog/end.php?id[]=&amp;url=./flag.txt</a></p>
<p>得出一张图片</p>
<p><img src="/images/pasted-242.png" alt="upload successful"><br>保存图片到本地，用vim打开搜flag,成功获取flag<br><img src="/images/pasted-243.png" alt="upload successful"><br>第10题flag</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2ebd3b08-47ffc478-b49a5f9d-f6099d65</span><br></pre></td></tr></table></figure>


<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>剩余的不会做。。😂😂😂关机撤退。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/15/firend_in_scholl/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="沫">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沫的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/15/firend_in_scholl/" class="post-title-link" itemprop="url">某黑客的联系方式</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-09-15 21:14:00 / 修改时间：22:26:38" itemprop="dateCreated datePublished" datetime="2020-09-15T21:14:00+08:00">2020-09-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index">
                    <span itemprop="name">渗透测试</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="发现某黑客留下的联系方式"><a href="#发现某黑客留下的联系方式" class="headerlink" title="发现某黑客留下的联系方式"></a>发现某黑客留下的联系方式</h3><p>害…又是一个枯燥无味的下午，本来今天扫了一大堆泛微云桥的漏洞准备去玩的，然后朋友丝毫不敢兴趣，本来我也是打算随便玩玩今天下午过去，万万没想到，朋友扫目录发现了这么一个东西。学校已经被黑客黑了，而且留下了这么一句话<br><img src="/images/pasted-197.png" alt="upload successful"><br>图为朋友用御剑扫的目录<br><img src="/images/pasted-215.png" alt="upload successful"></p>
<p>通过百度搜索发现这个人还挺喜欢留下自己的联系方式的，好吧竟然你就能黑进他们系统，我肯定也是要试试了</p>
<p><img src="/images/pasted-196.png" alt="upload successful"></p>
<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>朋友的老师给他授权的情况下，让他检测一下他们学校的漏洞，然后朋友那边已经通过内网扫好了端口，可惜因为域名过期，并不能通过工具去爆破子域名获取更多的渗透点，不过有这些端口信息给面的渗透做铺垫也还算不错</p>
<p><img src="/images/pasted-198.png" alt="upload successful"><br>另外一台主机开放端口状态<br><img src="/images/pasted-200.png" alt="upload successful"></p>
<h3 id="开始攻击"><a href="#开始攻击" class="headerlink" title="开始攻击"></a>开始攻击</h3><p>朋友给我发来了通达OA的地址让我进行已知漏洞进行攻击，通过简单的信息收集可以判定他是2017的，那么2017存在任意文件上传漏洞</p>
<p><img src="/images/pasted-201.png" alt="upload successful"><br>通过抓包数据进行修改，上传个小马进行权限获取，但是看到返回内容我就知道，失败咯，学校已经修复了该漏洞，剩余几个已知的通达OA系统需要先登陆才能进行利用，我这边已失败告终<br><img src="/images/pasted-202.png" alt="upload successful"><br>朋友内网发现了445端口是开放状态，想试试永恒之蓝，可惜不存在这个漏洞失败告别，并且一直在跑字典进行弱口令爆破，然而到最后也已失败告终。<br><img src="/images/pasted-199.png" alt="upload successful"></p>
<p>emmm上面我们两个双双失败，接下来，得拿出我最擅长的攻击手段，没错是时候打开网站进行手工漏洞挖掘了，说了这么多其实我到现在连他们主站点都还没看过</p>
<p>进入主站点后发现有个注册账号，但是点击进来告诉我们已经关闭了会员注册系统，放弃是不可能的，web关闭了或许后台还存在—别问，问就是依然失败</p>
<p><img src="/images/pasted-203.png" alt="upload successful"></p>
<p>找回密码，通过代码审计发现，他原网页是存在短信验证码找回，但是前端代码被注释了，但是问题不大，寻找到他包的发送点我们伪造一个就行，账号admin，手机号还是填我的。。哎，又以失败告终</p>
<p><img src="/images/pasted-204.png" alt="upload successful"></p>
<p>然后又失败了n次，在这里就不一一说明了，但是挖漏得有耐心。不能因为这点失败就说没漏洞。</p>
<h3 id="旁站的一个sql注入"><a href="#旁站的一个sql注入" class="headerlink" title="旁站的一个sql注入"></a>旁站的一个sql注入</h3><p>通过对他主站进行手工乱点，到了一个课程下载的地方，然后前端过滤了符号，并且是post请求，只能上抓包工具burp进行抓包测试，进行改包<br><img src="/images/pasted-205.png" alt="upload successful"><br>通过抓包修改他传递的参数发现，我的希望到来了，sql报错了，还回显了sql语句错误，nice<br><img src="/images/pasted-206.png" alt="upload successful"><br>上sqlmap，给我惊喜就完事了，nice，确定是sql注入，兄弟等着被我脱库吧。等等这是学校不能脱库……<br><img src="/images/pasted-207.png" alt="upload successful"><br>获取数据库名<br><img src="/images/pasted-208.png" alt="upload successful"><br>获取表名，看见这么多表我就知道，主数据库稳了<br><img src="/images/pasted-209.png" alt="upload successful"><br>拆表看看，果然。。。我想要的账号密码，都在这里面。。还有性别，邮箱各种的，爱了爱了，可能要加一波小姐姐qq了这是<br><img src="/images/pasted-210.png" alt="upload successful"><br>….后面一系列操作就不说了，反正最后成功拿到账号密码进行登陆。</p>
<h3 id="GetShell"><a href="#GetShell" class="headerlink" title="GetShell"></a>GetShell</h3><p>成功登陆后台后又是熟悉的木马上传。。。sorry说错了应该是图片上传，那我必须得上一个好看的图片<br><img src="/images/pasted-211.png" alt="upload successful"><br>然后成功getshell<br><img src="/images/pasted-212.png" alt="upload successful"><br>害，没想到权限这么大。net user必须是管理员权限才能执行的。。。我哭了，连提权都不用，就完成了本次渗透<br><img src="/images/pasted-213.png" alt="upload successful"></p>
<p>如果是黑客渗透进来，先说说，接下来他们怎么做，首先肯定是给自己添加一个账号，并且给予管理员权限，然后开启远程端口，进行远程桌面登陆，或者给一些持久性木马。。如果是我，肯定选择dll注入一个木马，这里就不谈这些了</p>
<p>本次渗透表示朋友给了授权，并且我也算是积极的保护一下我们祖国未来的栋梁之才的资料信息，emmm，然后十分感谢朋友咯</p>
<p><img src="/images/pasted-214.png" alt="upload successful"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>挖漏洞失败是很正常的。。。慢慢来，哈哈哈，还有就是，开头提的那个黑客qq。。其实我觉得吧，你像及了前段时间爆出宝塔漏洞越权访问数据库并删了政府的库还敢留联系方式的男人。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/09/14/%E6%B3%9B%E5%BE%AE%E4%BA%91%E6%A1%A5%E4%BB%BB%E6%84%8F%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="沫">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沫的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/09/14/%E6%B3%9B%E5%BE%AE%E4%BA%91%E6%A1%A5%E4%BB%BB%E6%84%8F%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/" class="post-title-link" itemprop="url">泛微云桥任意读取漏洞</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-09-14 16:54:00" itemprop="dateCreated datePublished" datetime="2020-09-14T16:54:00+08:00">2020-09-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-09-15 22:27:09" itemprop="dateModified" datetime="2020-09-15T22:27:09+08:00">2020-09-15</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="漏洞复现前的那个梗"><a href="#漏洞复现前的那个梗" class="headerlink" title="漏洞复现前的那个梗"></a>漏洞复现前的那个梗</h3><p>  这个漏洞是护网的时候爆出来的，相当的简单暴力，利用起来也简单，就一个越权完成了文件读取狠的一批，今晚挺无聊就扫了一批出来玩玩，本来想着放给朋友让他们去漏洞盒子撸点月饼，漏洞盒子今年也看漏洞多的一大堆索性就不让我们来白嫖月饼，改为朋友圈抽奖得月饼。</p>
<p><img src="/images/pasted-190.png" alt="upload successful"></p>
<p>月饼也没撸到还让帮漏洞盒子在朋友圈打个广告。</p>
<h3 id="利用方式"><a href="#利用方式" class="headerlink" title="利用方式"></a>利用方式</h3><p>读取任意文件内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;wxjsapi&#x2F;saveYZJFile?fileName&#x3D;test&amp;downloadUrl&#x3D;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&amp;fileExt&#x3D;txt</span><br></pre></td></tr></table></figure>
<p>把上面这句话丢到url后门，修改一些文件路径就能获取到一个md5加密的值，来看此图，没错打不开，也就是说明这是一台win系统服务器，那就换成win路径就可以，因为漏洞利用比较简单就不多说了</p>
<p><img src="/images/pasted-191.png" alt="upload successful"><br>正确的打开方式，读取linux系统上所有用户，这个id就是我们需要访问的文件<br><img src="/images/pasted-192.png" alt="upload successful"><br>查看内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file&#x2F;fileNoLogin&#x2F;加上刚刚的id的值</span><br></pre></td></tr></table></figure>
<p>哈哈哈 文件读取成功，对于平时喜欢ssh密钥登陆的，自己品吧。<br><img src="/images/pasted-193.png" alt="upload successful"></p>
<h3 id="修复建议"><a href="#修复建议" class="headerlink" title="修复建议"></a>修复建议</h3><p>更新最新版本，打最新版的补丁</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/08/28/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="沫">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沫的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/08/28/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95-%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86/" class="post-title-link" itemprop="url">渗透测试---信息收集</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-08-28 16:07:45 / 修改时间：16:08:47" itemprop="dateCreated datePublished" datetime="2020-08-28T16:07:45+08:00">2020-08-28</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="信息收集详解"><a href="#信息收集详解" class="headerlink" title="信息收集详解"></a>信息收集详解</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/22/Concurrent-threading/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="沫">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沫的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/22/Concurrent-threading/" class="post-title-link" itemprop="url">浅谈并发漏洞与修复方案</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-22 13:54:00" itemprop="dateCreated datePublished" datetime="2020-06-22T13:54:00+08:00">2020-06-22</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-06-25 14:57:32" itemprop="dateModified" datetime="2020-06-25T14:57:32+08:00">2020-06-25</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index">
                    <span itemprop="name">渗透测试</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="漏洞介绍"><a href="#漏洞介绍" class="headerlink" title="漏洞介绍"></a>漏洞介绍</h3><p>本次漏洞环境由python的Django框架，uwsgi，nginx进行搭配的一个生产环境，本次漏洞发生是这样的，前几天我的app被这漏洞进行攻击产生了一定的资金损失，当时去查看攻击者账号操作日志时发现，他们发送包请求的时候基本无任何延迟，从下图即可看出他应该是利用了多线程的爬虫对接口进行访问，访问过程中会服务器的接口会同时接收到很多请求，因为线程和线程之间本来就会出现资源竞争，所以导致了这次攻击事件发生</p>
<p><img src="/images/pasted-187.png" alt="upload successful"></p>
<h4 id="编写测试脚本证实漏洞"><a href="#编写测试脚本证实漏洞" class="headerlink" title="编写测试脚本证实漏洞"></a>编写测试脚本证实漏洞</h4><p>如果我们要复线上面这样的漏洞的话，必须要保障爬虫支持并发,以下代码是作为对漏洞测试作出的一个针对性脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="string">"""程序要求，支持高并发"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_post</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="string">"""发送post请求进行并发"""</span></span><br><span class="line">    url = <span class="string">'http://**.***.com/'</span></span><br><span class="line">    cookie = &#123;</span><br><span class="line">        <span class="string">'csrftoken'</span>: <span class="string">'y1bhsa9gyjkc0OwxvAHwZWGXTL53UcHynNlDTrK3oecxT7CA6iitDLgiVJw6II8g;'</span>,</span><br><span class="line">        <span class="string">'sessionid'</span>: <span class="string">'xhbh946pclgsohncrk1to0jvwbkn6gv8khcet'</span></span><br><span class="line">    &#125;</span><br><span class="line">    datas = &#123;</span><br><span class="line">        <span class="string">'id'</span>: <span class="string">'23889'</span>,</span><br><span class="line">        <span class="string">'password'</span>: <span class="string">'xie123456'</span></span><br><span class="line">    &#125;</span><br><span class="line">    header = &#123;</span><br><span class="line">        <span class="string">'X-CSRFtoken'</span>: <span class="string">'gFKsN2en0rITGOP6tQOBj416New3LMEo5rUOejPaQmAez7V94ypyXTBrPcX6zi56'</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    r_post = requests.post(url=url, data=json.dumps(datas), cookies=cookie, headers=header)</span><br><span class="line">    r_result = eval(r_post.content.decode())</span><br><span class="line">    <span class="comment"># print(r_result)</span></span><br><span class="line">    print(r_result[<span class="string">'errmsg'</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">        t_obj = threading.Thread(target=send_post)</span><br><span class="line">        t_obj.start()</span><br></pre></td></tr></table></figure>
<p>程序运行结果，果然存在该漏洞，当时攻击放应该是通过爬虫收集订单上的id，然后通过并发爬虫同时发起请求完成下单，所以他扣款只有一次，但是日志只要下单成功都会写入，由此我可以通过这个程序来测试自己的接口是否存在并发漏洞</p>
<p><img src="/images/pasted-188.png" alt="upload successful"></p>
<h4 id="使用锁来进行漏洞修复"><a href="#使用锁来进行漏洞修复" class="headerlink" title="使用锁来进行漏洞修复"></a>使用锁来进行漏洞修复</h4><p>这个漏洞是由线程之间资源抢夺发生的，所以最好的解决方案是，如果有很多个线程来访问这个接口，肯定有个第一个先来的，让他们通过排队的方式进行访问，因为数据库的四大特性，我可以利用他的隔离等级来进行防范，这里我使用的是悲观锁，悲观锁其实就是在当执行查询语句的时候加入了互斥锁，当在查询的时候上锁，在完成操作执行commit的时候就解锁，允许下一个线程进入。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PurchaseOrderView</span><span class="params">(LoginRequiredMixin, View)</span>:</span></span><br><span class="line">    <span class="string">"""这个视图用户订单购买"""</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self, request)</span>:</span></span><br><span class="line">        <span class="string">"""进行订单购买"""</span></span><br><span class="line">        json_dict = loads(request.body.decode())</span><br><span class="line">        order_id = json_dict.get(<span class="string">'id'</span>)</span><br><span class="line">        paypassword = json_dict.get(<span class="string">'password'</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> all([order_id, paypassword]):</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'code'</span>: Incomplete, <span class="string">'error'</span>: <span class="string">'OK'</span>, <span class="string">'errmsg'</span>: <span class="string">'参数不完整'</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 校验账号实名状态</span></span><br><span class="line">        <span class="keyword">if</span> request.user.status != <span class="string">'2'</span>:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'code'</span>: UserNotAuth, <span class="string">'error'</span>: <span class="string">'OK'</span>, <span class="string">'errmsg'</span>: <span class="string">'请先实名在进行交易'</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            order_id = int(order_id)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> Error:</span><br><span class="line">            print(Error)</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'code'</span>: Malice, <span class="string">'error'</span>: <span class="string">'OK'</span>, <span class="string">'errmsg'</span>: <span class="string">'禁止串改数据'</span>&#125;)</span><br><span class="line"></span><br><span class="line">        user_pay_password = request.user.password2</span><br><span class="line">        pay_password = md5_encode(paypassword)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># check pay password</span></span><br><span class="line">        <span class="keyword">if</span> user_pay_password != pay_password:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'code'</span>: Consistent, <span class="string">'error'</span>: <span class="string">'OK'</span>, <span class="string">'errmsg'</span>: <span class="string">'支付密码错误'</span>&#125;)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># if order_obj.user_order == int(order_id):</span></span><br><span class="line">        <span class="comment">#     print('是自己的订单')</span></span><br><span class="line">        <span class="comment"># print(order_obj.id)</span></span><br><span class="line">        <span class="comment"># mr_id = order_obj.user_order</span></span><br><span class="line">        <span class="comment"># print(mr_id)</span></span><br><span class="line">        <span class="comment"># 如果订单下单，就回显，订单下单</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 使用事务，开始处理业务逻辑</span></span><br><span class="line">        <span class="keyword">with</span> transaction.atomic():</span><br><span class="line">            <span class="comment"># 创建事务节点</span></span><br><span class="line">            save_id = transaction.savepoint()</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 给自己的余额余额加锁</span></span><br><span class="line">            user_obj_lock = Account.objects.select_for_update().get(username=request.user.username)</span><br><span class="line">            <span class="comment"># 判断当前账户的资金是否有资金对货币进行购买</span></span><br><span class="line">            before_mc = float(user_obj_lock.money)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                order_obj = Order.objects.get(id=int(order_id))</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> Error:</span><br><span class="line">                print(Error)</span><br><span class="line">                JsonResponse(&#123;<span class="string">'code'</span>: Malice, <span class="string">'error'</span>: <span class="string">'OK'</span>, <span class="string">'errmsg'</span>: <span class="string">'该订单不存在'</span>&#125;)</span><br><span class="line">            <span class="comment"># 判断这个订单是自己的么，如果是自己的就不可以进行交易</span></span><br><span class="line">            <span class="comment"># print(order_obj.user_order_id)</span></span><br><span class="line">            <span class="comment"># print(request.user.id)</span></span><br><span class="line">            <span class="keyword">if</span> order_obj.user_order_id == request.user.id:</span><br><span class="line">                <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'code'</span>: SelfOrder, <span class="string">'error'</span>: <span class="string">'OK'</span>, <span class="string">'errmsg'</span>: <span class="string">'对不起你不能购买自己的订单'</span>&#125;)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> order_obj.num + order_obj.num * Service_charge &gt;= before_mc:</span><br><span class="line">                <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'code'</span>: BalanceInsufficient, <span class="string">'error'</span>: <span class="string">'OK'</span>, <span class="string">'errmsg'</span>: <span class="string">'对不起余额不足'</span>&#125;)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 如果订单下单，就回显，订单下单</span></span><br><span class="line">            <span class="keyword">if</span> order_obj.status != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'code'</span>: SelfOrder, <span class="string">'error'</span>: <span class="string">'OK'</span>, <span class="string">'errmsg'</span>: <span class="string">'该订单已被下单，请刷新试试'</span>&#125;)</span><br><span class="line">            <span class="comment"># 对账户余额进行扣钱</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># print(order_obj.num + order_obj.num * Service_charge)</span></span><br><span class="line">                <span class="comment"># return 1</span></span><br><span class="line">                request.user.money = float(request.user.money) - (order_obj.num + order_obj.num * Service_charge)</span><br><span class="line">                request.user.save()</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> Error:</span><br><span class="line">                print(Error)</span><br><span class="line">                <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'code'</span>: Malice, <span class="string">'error'</span>: <span class="string">'OK'</span>, <span class="string">'errmsg'</span>: <span class="string">'对账户扣款操作失败'</span>&#125;)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 写入日志</span></span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                MachineBuyLog.objects.create(</span><br><span class="line">                    user=request.user.username,</span><br><span class="line">                    content=<span class="string">'货币卖出:扣除&#123;&#125;YXC'</span>.format(order_obj.num + order_obj.num * Service_charge),</span><br><span class="line">                    user_key_id=request.user.id</span><br><span class="line">                ).save()</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> Error:</span><br><span class="line">                print(Error)</span><br><span class="line">                <span class="comment"># 回滚</span></span><br><span class="line">                transaction.savepoint_rollback(save_id)</span><br><span class="line">                <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'code'</span>: LogError, <span class="string">'error'</span>: <span class="string">'OK'</span>, <span class="string">'errmsg'</span>: <span class="string">'日志写入错误，请重新下单，联系客服'</span>&#125;)</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="comment"># 订单进行更新到交易中状态  状态码修改为1 到交易中状态，添加卖家的账号</span></span><br><span class="line">                order_obj.mc_user = request.user.username</span><br><span class="line">                order_obj.frozen = order_obj.num + order_obj.num * Service_charge</span><br><span class="line">                order_obj.status = <span class="number">1</span></span><br><span class="line">                order_obj.purchase_time = time.time()</span><br><span class="line">                order_obj.save()</span><br><span class="line">                <span class="comment"># 发送短信，通知卖家</span></span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> send_verifications(order_obj.mr_user, <span class="string">'1234'</span>, <span class="string">'down_order'</span>):</span><br><span class="line">                    <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'code'</span>: SendMobileError, <span class="string">'error'</span>: <span class="string">'OK'</span>, <span class="string">'errmsg'</span>: <span class="string">'订单卖出成功，短信通知失败'</span>&#125;)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                print(e)</span><br><span class="line">                transaction.savepoint_rollback(save_id)</span><br><span class="line">                <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'code'</span>: BuyError, <span class="string">'error'</span>: <span class="string">'OK'</span>, <span class="string">'errmsg'</span>: <span class="string">'订单购买失败'</span>&#125;)</span><br><span class="line">            <span class="comment"># 写入日志</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 提交成功，执行事务提交</span></span><br><span class="line">        transaction.savepoint_commit(save_id)</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'code'</span>: Ok, <span class="string">'error'</span>: <span class="string">'OK'</span>, <span class="string">'errmsg'</span>: <span class="string">'订单卖出成功请到我的卖出进行查看'</span>&#125;)</span><br></pre></td></tr></table></figure>
<p>说实话，我不太想爆出我系统购买订单的源码的，关于django框架在这里也不多说，</p>
<p>悲观锁</p>
<pre><code>悲观锁类似于我们在多线程资源竞争时添加的互斥锁，容易出现死锁现象。</code></pre><p>乐观锁</p>
<pre><code>乐观锁并不是真实存在的锁，而是在更新的时候判断此时的库存是否是之前查询出    的库存，如果相同，表示没人修改，可以更新库存，否则表示别人抢过资源，不再    执行库存更新。类似如下操作</code></pre><p>我用的解决方案是悲观锁，因为对我现在来说能更快的保障程序正常运行就是最佳方案，但存在一个缺点，如果我的订单处理哪里发生异常，那么用户的访问就会一直进行堵塞。上面提到了，有很多个线程进入，但是只有拿到锁的那个线程才能继续执行下面逻辑，其余的线程都在外面排队，必须执行事务提交该线程才能释放这个锁，别的线程才能执行，也就是程序发生了死锁行为，死锁在这里不做多解释。</p>
<h4 id="分析日志抓恶意账号"><a href="#分析日志抓恶意账号" class="headerlink" title="分析日志抓恶意账号"></a>分析日志抓恶意账号</h4><p>存在这个漏洞的接口有好几个，经过各种不懈的测试都通过加锁进行了修复，是时候分析日志抓取这些恶意账号了，这里就不上代码了。就是分析行为，emmm对于本次攻击事件完美善后，写个blog 压压惊，以下账号先封个180天emmm。<br><img src="/images/pasted-189.png" alt="upload successful"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/20/DVWA-injection-Medium/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="沫">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沫的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/20/DVWA-injection-Medium/" class="post-title-link" itemprop="url">DVWA-sql注入POST+工具</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-06-20 17:01:00 / 修改时间：17:29:41" itemprop="dateCreated datePublished" datetime="2020-06-20T17:01:00+08:00">2020-06-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index">
                    <span itemprop="name">渗透测试</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="攻击准备"><a href="#攻击准备" class="headerlink" title="攻击准备"></a>攻击准备</h3><pre><code>抓包工具 burp
注入工具 sqlmap</code></pre><h4 id="Medium等级代码"><a href="#Medium等级代码" class="headerlink" title="Medium等级代码"></a>Medium等级代码</h4><p>通过以下代码可以发现，他还是没有对id这个参数进行任何过滤，只不过这次传递参数是使用的select 和 option组件，所以需要进行抓包来进行注入，这次的难度和low相比只不过是get传递变成了post传递，和回显<br><img src="/images/pasted-181.png" alt="upload successful"></p>
<h5 id="Burp抓包"><a href="#Burp抓包" class="headerlink" title="Burp抓包"></a>Burp抓包</h5><p>配置代理，监听本地8080端口使用burp进行转发</p>
<p><img src="/images/pasted-182.png" alt="upload successful"><br>抓这个带有漏洞的包，将他以文本的方式进行保存<br><img src="/images/pasted-183.png" alt="upload successful"><br>这里我已经把包的内容进行了保存</p>
<p><img src="/images/pasted-184.png" alt="upload successful"></p>
<h5 id="sqlmap开始漏洞攻击"><a href="#sqlmap开始漏洞攻击" class="headerlink" title="sqlmap开始漏洞攻击"></a>sqlmap开始漏洞攻击</h5><p>然后就和之前写的一样了，一大堆花里胡哨咯<br><img src="/images/pasted-185.png" alt="upload successful"><br>跑出来的结果也和之前一样</p>
<p><img src="/images/pasted-186.png" alt="upload successful"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/19/DVWA-update-file/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="沫">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沫的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/19/DVWA-update-file/" class="post-title-link" itemprop="url">DVWA-update-file(文件上传漏洞)Low-Medium</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-06-19 07:45:00 / 修改时间：10:19:08" itemprop="dateCreated datePublished" datetime="2020-06-19T07:45:00+08:00">2020-06-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/" itemprop="url" rel="index">
                    <span itemprop="name">渗透测试</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="文件上传漏洞简介"><a href="#文件上传漏洞简介" class="headerlink" title="文件上传漏洞简介"></a>文件上传漏洞简介</h3><p>文件上传漏洞，由于没有对上传文件的类型和内容进行过滤、检查，使攻击者可以通过上传木马获取webshell权限，因此文件上传漏洞带来的危害使极高的，接下来对dvwa的三种文件上传漏洞进行分析，本次攻击针对low级别和Medium级别进行攻击测试</p>
<h4 id="1-LOW"><a href="#1-LOW" class="headerlink" title="1.LOW"></a>1.LOW</h4><p>1.low级别源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_POST[ <span class="string">'Upload'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Where are we going to be writing to?</span></span><br><span class="line">    $target_path  = DVWA_WEB_PAGE_TO_ROOT . <span class="string">"hackable/uploads/"</span>;</span><br><span class="line">    $target_path .= basename( $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'name'</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Can we move the file to the upload folder?</span></span><br><span class="line">    <span class="keyword">if</span>( !move_uploaded_file( $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'tmp_name'</span> ], $target_path ) ) &#123;</span><br><span class="line">        <span class="comment">// No</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Yes!</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;&#123;$target_path&#125; succesfully uploaded!&lt;/pre&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过阅读可以发现，没有任何的文件类型过滤和检查，存在文件上传漏洞，生成上传路径后，服务器会检测是否上传成功并且返回相关的信息</p>
<p>文件上传漏洞利用是有一定的限制条件的，首先必须要成功上传木马，其次木马能被执行，也就是知道文件上传的路径是需要我们知道的</p>
<h5 id="Low级别漏洞利用"><a href="#Low级别漏洞利用" class="headerlink" title="Low级别漏洞利用"></a>Low级别漏洞利用</h5><p>1.先上传一个php一句话木马，hacker.php,参数名为一句话木马，为mo_hacker,然后去dvwa进行上传</p>
<p><img src="/images/pasted-168.png" alt="upload successful"></p>
<p>dvwa一句话木马上传成功，因为我的靶机用的是win10，在上传木马的时候被系统拦截多次，如果要做测试的话，建议关闭win10的病毒和威胁保护<br><img src="/images/pasted-169.png" alt="upload successful"></p>
<p>3.这个时候就可以用中国蚁剑进行链接了</p>
<p><img src="/images/pasted-170.png" alt="upload successful"><br>4.然后中国蚁剑就会向服务器发送包含hacker_mo的post请求，在服务器执行命令，获取webshell，可以下载，修改服务器的所有文件<br><img src="/images/pasted-171.png" alt="upload successful"><br>5.获取权限后吧cmd上传，此时是没有whomi 查看连接的权限的，需要进行提取</p>
<pre><code>补充：以下这几种命令有admin权限才能执行
1.net user 查看用户
2.net user username password /add 添加账户
3.net localgroup Administrators username /add 吧新建的账号添加到管理员组
4.net start telnet 开启靶机telnet服务 (利用telnet登陆，使用ftp吧nc下载到靶机并运行，这样就建立了后门)
5.systeminfo 查看计算机的信息 （操作系统，位数，系统补丁状态）可以通过漏洞进行提权
6.tasklist/svc 查看计算机的进程
7.netstat -ano 查看计算机网络端口连接</code></pre><p>如果webshell不能执行cmd那么就需要上传一个cmd，上传cmdcmd不能添加用户，那么就需要通过一些方式进行去上传cmd进行账户添加</p>
<p>6.low级别安全策略</p>
<p>low级别没有进行任何的过滤，任何文件都可以上传，导致获取webshell</p>
<h4 id="2-Medium"><a href="#2-Medium" class="headerlink" title="2.Medium"></a>2.Medium</h4><p>1.dvwa的medium难度中直接上传木马，他会告诉你，你的图像未上传，我们只能接受jpeg或者png的图片</p>
<p><img src="/images/pasted-172.png" alt="upload successful"><br>2.先来读一下Medium难度的源码吧</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( <span class="keyword">isset</span>( $_POST[ <span class="string">'Upload'</span> ] ) ) &#123;</span><br><span class="line">    <span class="comment">// Where are we going to be writing to?</span></span><br><span class="line">    $target_path  = DVWA_WEB_PAGE_TO_ROOT . <span class="string">"hackable/uploads/"</span>;</span><br><span class="line">    $target_path .= basename( $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'name'</span> ] );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// File information</span></span><br><span class="line">    $uploaded_name = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'name'</span> ];</span><br><span class="line">    $uploaded_type = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'type'</span> ];</span><br><span class="line">    $uploaded_size = $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'size'</span> ];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Is it an image?</span></span><br><span class="line">    <span class="keyword">if</span>( ( $uploaded_type == <span class="string">"image/jpeg"</span> || $uploaded_type == <span class="string">"image/png"</span> ) &amp;&amp;</span><br><span class="line">        ( $uploaded_size &lt; <span class="number">100000</span> ) ) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Can we move the file to the upload folder?</span></span><br><span class="line">        <span class="keyword">if</span>( !move_uploaded_file( $_FILES[ <span class="string">'uploaded'</span> ][ <span class="string">'tmp_name'</span> ], $target_path ) ) &#123;</span><br><span class="line">            <span class="comment">// No</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Your image was not uploaded.&lt;/pre&gt;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// Yes!</span></span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;&#123;$target_path&#125; succesfully uploaded!&lt;/pre&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// Invalid file</span></span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;pre&gt;Your image was not uploaded. We can only accept JPEG or PNG images.&lt;/pre&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>通过阅读源码可以发现，Medium难度级别的对上传文件对类型，大小做了限制，要求文件类型必须是图片格式，大小不能超过100kb</p>
<h5 id="Medium级别漏洞利用"><a href="#Medium级别漏洞利用" class="headerlink" title="Medium级别漏洞利用"></a>Medium级别漏洞利用</h5><p>1.先测试是否对内容就行了过滤</p>
<p>因为我们使用的是一句话木马，所以文件大小不会出现问题。先尝试修改文件后缀<br><img src="/images/pasted-173.png" alt="upload successful"><br>修改完文件后缀去进行上传，服务器回应上传成功,虽然文件上传成功了，但是png文件是无法被解析对，所以无法获取webshell<br><img src="/images/pasted-174.png" alt="upload successful"></p>
<p>2.打开中国蚁剑，进行连接测试查看是否可以获取webshell,如图可发现获取webshell失败<br><img src="/images/pasted-175.png" alt="upload successful"><br>3.中国蚁剑的原理是向上传的文件发送包含hack参数的post请求，通过控制ack参数来执行不同的命令，而服务器将木马文件解析成了图片，因此发送post请求时，服务只会返回这个图片文件，并不会执行命令</p>
<p>4.通过burp抓包将解析为php文件，抓包修改文件类型，上传hacker.png文件</p>
<p>burp抓包准备工作，配置代理，burp默认监听8080端口，在这里我抓取的是http请求，所以只需要配置http代理就行<br><img src="/images/pasted-176.png" alt="upload successful"></p>
<p>查看该请求包，我们发现content-type是image/png，也就是这个包只能是图片类型</p>
<p><img src="/images/pasted-177.png" alt="upload successful"><br>5.修改filename为hacke.php</p>
<p>我们吧该包发送到repeater里进行篡改，把原有的png，改成php，然后发送这个包<br><img src="/images/pasted-179.png" alt="upload successful"></p>
<p>6.打开中国蚁剑查看是否能获取webshell</p>
<p>如果所示，中国蚁剑连接成功<br><img src="/images/pasted-180.png" alt="upload successful"></p>
<p>7.Medium级别安全策略</p>
<p>在Medium级别中，本身他过滤了文件类型，但是最后保存文件的时候，并没有判断文件后缀导致木马成功上传，所以导致被获取webshell</p>
<h4 id="文件上传安全配置"><a href="#文件上传安全配置" class="headerlink" title="文件上传安全配置"></a>文件上传安全配置</h4><p>文件上传在业务逻辑中非常常用，但是错误的上传可能会导致服务器被恶意占用大量流量导致服务器瘫痪，也会因为判断文件类型导致服务器被获取webshell，所以我们只需要做到以下几点即可避免这些攻击</p>
<pre><code>1.限制文件的上传大小，避免服务器被恶意文件占用大量资源
2.用户的数据都是不可信的，我们必须判断后缀文件名，避免被解析
3.php上传文件目录不解析php代码
4.正式环境中可以选择使用阿里云oss，七牛云等服务来避免文件上传</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/18/%E5%87%BD%E6%95%B0%E7%9A%84%E5%87%A0%E7%A7%8D%E7%89%B9%E5%BE%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="沫">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沫的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/18/%E5%87%BD%E6%95%B0%E7%9A%84%E5%87%A0%E7%A7%8D%E7%89%B9%E5%BE%81/" class="post-title-link" itemprop="url">函数的几种特征</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-05-18 19:46:00 / 修改时间：20:09:20" itemprop="dateCreated datePublished" datetime="2020-05-18T19:46:00+08:00">2020-05-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6/" itemprop="url" rel="index">
                    <span itemprop="name">高等数学</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="有界性"><a href="#有界性" class="headerlink" title="有界性"></a>有界性</h3><p>上界：∃k1</p>
<pre><code>假设f(x)这个定义域最大为300，那么就是k1大于等于这个值
f(x) &lt;= k1</code></pre><p>下界：∃k2</p>
<pre><code>f(x) &gt;= k2
最后f(x)结果永远小于k2</code></pre><p>有界：∃k1&gt;=3 ∃k2 &lt;=3</p>
<pre><code>k1 &gt;= f(x) &lt;= k2
那么f(x)=3，因为k1作为上界,他的值为3 到 无限，k2，为下界3 到 -无限,根据表达式得出他为3</code></pre><p>无界：∃m</p>
<pre><code>m &lt; f(x1), m2 = ∀
m他作为一个下界，m2作为一个任意数</code></pre><h3 id="单调性"><a href="#单调性" class="headerlink" title="单调性"></a>单调性</h3><pre><code>x1 &lt; x2 f(x1) &lt; f(x2)  单调增
x1 &lt; x2 f(x1) &gt; f(x2)  单调减</code></pre><h3 id="奇偶性D关于圆点对称"><a href="#奇偶性D关于圆点对称" class="headerlink" title="奇偶性D关于圆点对称"></a>奇偶性D关于圆点对称</h3><pre><code>f(-x) = f(x) 偶
f (-x) = f(-x) 奇</code></pre><h3 id="周期性"><a href="#周期性" class="headerlink" title="周期性"></a>周期性</h3><p>∃正数i</p>
<pre><code>f(x + i) = f(x)
最小周期 y = sin x的最小周期2π</code></pre><p>并非每个周期函数都有最小周期</p>
<pre><code>这个说实话贼抽像，电脑画图不太好画，所以就不上图了

不存在最小的有理数作为周期
假设：
D(x) = 1  x ∈ Q   有理数
D(x) = 0  x ∈ Qc  无理数
任何x + r的有理数相加都数一个有理数，所以不存在最小的周期
x + 有理数 + r = 有理数
x + 无理数 + r = 无理数</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/15/%E5%87%BD%E6%95%B0%E5%9B%9E%E9%A1%BE-%EF%BC%88%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="沫">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沫的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/15/%E5%87%BD%E6%95%B0%E5%9B%9E%E9%A1%BE-%EF%BC%88%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6%EF%BC%89/" class="post-title-link" itemprop="url">函数回顾（高数）</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-05-15 16:16:00 / 修改时间：19:22:19" itemprop="dateCreated datePublished" datetime="2020-05-15T16:16:00+08:00">2020-05-15</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6/" itemprop="url" rel="index">
                    <span itemprop="name">高等数学</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="函数和映射的关系"><a href="#函数和映射的关系" class="headerlink" title="函数和映射的关系"></a>函数和映射的关系</h3><p>D ⊂ R<br /><br>D是一个定义域，R是实数集<br /><br>函数是数集 → 数集 之间的映射，数集里面必须要有一个实数<br /><br>映射是集合 → 集合之间的对应</p>
<pre><code>映射的集合
X = {桌子，筷子}
Y = {板凳，碗}
映射可以的出 f = x1 → Rf,x1 ⊂ Df,Rf ⊂ Y,映射里面的集合可以桌子对应板凳，也就是x1 = y1,但是函数就不行
函数数集
X = {1,2,3}
Y = {1,2,3}
f:D → R 
f是一个映射，从一个定义域，到值域的映射R是一个实数集
定义的函数为：y = f（x）,x ∈ D, x为自变量，y为因变量，D为定义域，可以记做Df，值域Rf = f（D），f为一个规则，f（x）表示一个函数值</code></pre><h3 id="构成函数的两大要素"><a href="#构成函数的两大要素" class="headerlink" title="构成函数的两大要素"></a>构成函数的两大要素</h3><p>定义域Df，f作为规则</p>
<h3 id="函数的三种表达方式，图形-表格，公式"><a href="#函数的三种表达方式，图形-表格，公式" class="headerlink" title="函数的三种表达方式，图形,表格，公式"></a>函数的三种表达方式，图形,表格，公式</h3><pre><code>例1:y =  |x|
假设x &lt; 0 就是相反数
x &gt;= 0 就是他本身
定义域为： D = （-♾，+♾）也就是x可以无限小，也可以无限大
值域 Rf（-♾，+♾）</code></pre><p>图解如下：</p>
<p><img src="/images/pasted-165.png" alt="upload successful"></p>
<p>符号函数sign</p>
<pre><code>例2：y = sgn * x  符号函数（sign）
这个函数我们可以给出以下三种假设
x &gt; 0   
x = 0   
x &lt; 0  </code></pre><p>图解如下<br><img src="/images/pasted-167.png" alt="upload successful"></p>
<p>计算sign * x的绝对值</p>
<pre><code> 如果x是正数，那么结对值为 x,那么y等于x自身
y = sgn * |x|
如果x是负数，那么y等 x
y = sgin * -|x|
得出结果 y 的sgin绝对值为：y = x，如果x是0，任何数 * x 都是0</code></pre><p>取整函数</p>
<pre><code>取整函数[x]
   [x]:不超过x的最大整数
[3.1] = 3
[5] = 5
[-1.6] = 2</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/14/python-%E6%98%A0%E5%B0%84%E4%B8%8E%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="沫">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="沫的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/14/python-%E6%98%A0%E5%B0%84%E4%B8%8E%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">映射与函数(高数)</a>
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-14 20:10:00" itemprop="dateCreated datePublished" datetime="2020-05-14T20:10:00+08:00">2020-05-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-15 19:22:39" itemprop="dateModified" datetime="2020-05-15T19:22:39+08:00">2020-05-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6/" itemprop="url" rel="index">
                    <span itemprop="name">高等数学</span>
                  </a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="映射与函数"><a href="#映射与函数" class="headerlink" title="映射与函数"></a>映射与函数</h3><p>X，Y非空集合，法则f对x中<br /><br>大的X数集合，小的x为元素，每个元素x，会和y唯一的与之对应<br /><br>f 映射 f：X → Y<br /><br>X被称只为像，Y为原像<br /><br>X为定义域，记为Df<br /><br>Y为值域，记为Rf<br /><br>以上为映射函数的最基础定义</p>
<h3 id="注意：三要素X，f，Rf"><a href="#注意：三要素X，f，Rf" class="headerlink" title="注意：三要素X，f，Rf"></a>注意：三要素X，f，Rf</h3><p>在python中比进行举例，因为python中集合的值不可以直接通过下标来取，所以用元组进行代替</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">X = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) <span class="comment"># 假设X为像</span></span><br><span class="line">Y = (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>) <span class="comment"># 假设Y为原像</span></span><br><span class="line">x1 = X[<span class="number">0</span>] <span class="comment"># X中的一个元素</span></span><br><span class="line">y1 = Y[<span class="number">0</span>] <span class="comment"># Y中的一个元素</span></span><br></pre></td></tr></table></figure>
<p>通过以上例子可以发现，y1至是Y中的一个值，被记做Rf，也就是Rf ⊂ Y，也就是Rf属于Y，值域为1，在这里比喻是用的数字相对，来进行匹配。<br>&lt;br/ &gt;<br>x1只需要对应其中任意一种Rf即可，不是所有的Rf都必须要用到，但是x必须要用到，上面代码中的x1 = 1，其实也可以对应其他的Y元素，只要保证x进行对应就是可以的。</p>
<h3 id="x-∈-X-x的对应必须是唯一的"><a href="#x-∈-X-x的对应必须是唯一的" class="headerlink" title="x ∈ X x的对应必须是唯一的"></a>x ∈ X x的对应必须是唯一的</h3><p>因为x和X是属于关系，x是X集合中的一个元素，所以记做x ∈ X，就好比上面代码中的，X定义了一个1，2，3的集合，但是<br /><br>x1 可以指向 y1，x1只能指向一个值也就是Rf，Rf是存于y中<br /><br>但是y1可以指向多个x，也就是x1可以等于y1，x2也可以等于y1</p>
<h3 id="满射-Rf-Y"><a href="#满射-Rf-Y" class="headerlink" title="满射 Rf = Y"></a>满射 Rf = Y</h3><p>当y里的元素全部对应，也就是X和Y的元素一样多，当他们完全对应，并且原像里没有剩余的元素则为满射，也就是Rf = Y。<br /><br>图解如下：<br><img src="/images/pasted-163.png" alt="upload successful"></p>
<h3 id="单射"><a href="#单射" class="headerlink" title="单射"></a>单射</h3><p>x1 != x2 f(x1) != f(x2)<br>也就是单个x元素对应不同的Rf，Y的元素可以不完全用于，只要匹配x1 = y1就满足单射</p>
<h3 id="逆映射"><a href="#逆映射" class="headerlink" title="逆映射"></a>逆映射</h3><p>假设 f:x → 单射&lt;br/ &gt;<br>每个y ∈ Rf 有唯一的x ∈ X<br /><br>f(x) = y<br /><br>g:Rf → x 记为 f-1<br /><br>Df-1 = Rf Rf-1 = X<br /><br>只有单射才有逆映射</p>
<h3 id="复合映射"><a href="#复合映射" class="headerlink" title="复合映射"></a>复合映射</h3><p>g:X → y1  f:y2 → z<br>记做为 f[g(x)] ∈ z<br>z里存在多个元素，所以X → z，所以f != Z 但是 Z ⊂ f<br /><br>复合映射图解:<br><img src="/images/pasted-161.png" alt="upload successful"><br>图画的虽然不咋地，但是差不多是这个意思吧，重图中，可以看出来X里的一个元素，指向了y1，也就是Y里的某一个元素，在y1里面还有一个值叫Rg，他指向了Z，值域是在Z里面，也许只是Z的一小部分，所以Z ⊂ f，两者不是等于关于关系。<br /></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let activeClass = CONFIG.comments.activeClass;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="沫"
      src="/images/avatar.gif">
  <p class="site-author-name" itemprop="name">沫</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">35</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">沫</span>
</div>


        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
